# バリデーションルール

釣果記録アプリのデータ入力バリデーションルールをまとめたドキュメントです。

---

## 📋 入力チェック項目

### 1. **必須項目チェック**

#### 必須フィールド
- ✅ DATE（日付）
- ✅ AREA（エリア）
- ✅ LOCATION（場所）

#### エラーメッセージ
- `DATEが空やで` - 日付が未入力
- `エリアを選択してください` - エリアが未選択
- `釣り場を選択してください` - 場所が未選択

---

### 2. **サイズ内訳チェック**

#### ルール
```
年無し + 45-49cm + 40-44cm + 30-39cm + <30cm ≤ 釣果数
```

#### 具体例

**✅ OK（合計が釣果数以下）**
```
釣果数 (TOTAL): 10
年無し (50cm over): 2
45~49cm: 1
40~44cm: 3
30~39cm: 2
< 30cm: 1
---
合計: 2 + 1 + 3 + 2 + 1 = 9 ≤ 10 ✅
不明: 10 - 9 = 1匹
```

**🚫 NG（合計が釣果数を超える）**
```
釣果数 (TOTAL): 5
年無し (50cm over): 2
45~49cm: 1
40~44cm: 3
30~39cm: 1
< 30cm: 0
---
合計: 2 + 1 + 3 + 1 + 0 = 7 > 5 ❌
```

#### エラーメッセージ
```
🚫 サイズ内訳がトータルを超えています
```

---

### 3. **あたり数チェック（新規追加）**

#### ルール
```
あたり数 ≥ 釣果数（あたり数が指定されている場合）
```

**理由**: あたりがあっても釣れないことはあるが、釣れたということはあたりがあったということ。

#### 具体例

**✅ OK（あたり数 ≥ 釣果数）**
```
釣果数 (TOTAL): 5
あたり数 (HIT COUNT): 10
---
10 ≥ 5 ✅
```

**✅ OK（あたり数が未入力）**
```
釣果数 (TOTAL): 5
あたり数 (HIT COUNT): --- (未入力)
---
未入力は OK ✅
```

**✅ OK（あたり数 = 釣果数）**
```
釣果数 (TOTAL): 5
あたり数 (HIT COUNT): 5
---
5 = 5 ✅（全てのあたりが釣果になった）
```

**🚫 NG（あたり数 < 釣果数）**
```
釣果数 (TOTAL): 10
あたり数 (HIT COUNT): 5
---
5 < 10 ❌（あたりより多く釣れることはありえない）
```

#### エラーメッセージ
```
🚫 あたり数は釣果数以上である必要があります
```

---

### 4. **餌別内訳チェック**

#### ルール
```
サブ餌1 + サブ餌2 + サブ餌3 ≤ 釣果数
```

メイン餌の数は自動計算される：
```
メイン餌 = 釣果数 - (サブ餌1 + サブ餌2 + サブ餌3)
```

#### 具体例

**✅ OK（サブ餌合計が釣果数以下）**
```
釣果数 (TOTAL): 10
メイン餌: イガイ
サブ餌1: カニ × 3
サブ餌2: 赤イソメ × 2
サブ餌3: 未入力
---
サブ餌合計: 3 + 2 = 5 ≤ 10 ✅
メイン餌（イガイ）: 10 - 5 = 5匹
```

**🚫 NG（サブ餌合計が釣果数を超える）**
```
釣果数 (TOTAL): 5
メイン餌: イガイ
サブ餌1: カニ × 3
サブ餌2: 赤イソメ × 4
---
サブ餌合計: 3 + 4 = 7 > 5 ❌
```

#### エラーメッセージ
```
🚫 エサ内訳がトータルを超えています
```

---

## 📊 バリデーション適用箇所

### LOG タブ（新規記録）
- ✅ 必須項目チェック
- ✅ サイズ内訳チェック
- ✅ あたり数チェック
- ✅ 餌別内訳チェック

### EDIT モーダル（編集）
- ✅ 必須項目チェック
- ✅ サイズ内訳チェック
- ✅ あたり数チェック
- ✅ 餌別内訳チェック

---

## 🎯 バリデーション実装コード

### サイズ内訳チェック
```typescript
if (toshiVal + s45 + s40 + s30 + sUnder30 > countVal) { 
  showToast("サイズ内訳がトータルを超えています", true); 
  return 
}
```

### あたり数チェック
```typescript
if (hitCountVal !== null && hitCountVal < countVal) {
  showToast("あたり数は釣果数以上である必要があります", true)
  return
}
```

### 餌別内訳チェック
```typescript
const mainCount = countVal - detailSum
if (mainCount < 0) { 
  showToast("エサ内訳がトータルを超えています", true); 
  return 
}
```

---

## 📝 バリデーション順序

1. **必須項目チェック** → エラー時は即座に中断
2. **サイズ内訳チェック** → エラー時は即座に中断
3. **あたり数チェック** → エラー時は即座に中断
4. **餌別内訳チェック** → エラー時は即座に中断
5. **保存処理** → 全てのチェックをパスした場合のみ実行

---

## 💡 ユーザーへのヒント

### よくあるエラーと対処法

#### ❌ 「サイズ内訳がトータルを超えています」
**原因**: サイズ別の数を合計すると、釣果数を超えている

**対処法**:
1. 各サイズの数を確認
2. 合計が釣果数以下になるように調整
3. または釣果数を増やす

---

#### ❌ 「あたり数は釣果数以上である必要があります」
**原因**: あたり数が釣果数より少ない

**対処法**:
1. あたり数を増やす（釣果数以上にする）
2. または釣果数を減らす
3. またはあたり数を未入力（`---`）にする

**よくある間違い**:
```
釣果数: 10
あたり数: 5  ← ❌ 10匹釣れたのに、あたりが5回？

正しくは:
釣果数: 10
あたり数: 15  ← ✅ 15回あたりがあって、10匹釣れた
```

---

#### ❌ 「エサ内訳がトータルを超えています」
**原因**: サブ餌の合計が釣果数を超えている

**対処法**:
1. サブ餌の数を減らす
2. または釣果数を増やす
3. メイン餌の数は自動計算されるため、入力不要

---

## 🚀 まとめ

### バリデーションが保証すること

1. ✅ **データの整合性**
   - サイズ内訳が釣果数を超えない
   - あたり数が釣果数を下回らない
   - 餌別内訳が釣果数を超えない

2. ✅ **論理的な正しさ**
   - 釣れた数 ≤ あたりの数
   - サイズ別の合計 ≤ 釣果数
   - 餌別の合計 ≤ 釣果数

3. ✅ **分析の正確性**
   - 不明サイズの自動計算が正しく機能
   - 統計グラフが正確なデータを反映
   - データ入力ミスを防止

---

**すべてのバリデーションは LOG タブと EDIT モーダルの両方で機能します。** 🎣✨
